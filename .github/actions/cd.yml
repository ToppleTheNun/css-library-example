# Set name of workflow in GitHub Actions
name: CD

# Only run this workflow on push to main
on:
  push:
    branches:
      - main

# Define jobs within the workflow
jobs:

  # Define a job
  cd:
    # Run this job on Ubuntu
    runs-on: ubuntu-latest

    # Only run this job if the commit message doesn't contain "[skip release]"
    if: "! contains(toJSON(github.event.commits.*.message), '[skip release]')"

    # Define steps within the job
    steps:
      # Check out the source code
      - name: Checkout Code
        uses: actions/checkout@v2 # https://github.com/actions/checkout
        with:
          # fetch the entire git history
          fetch-depth: '0'

      # Install dependencies
      - name: Install Dependencies
        uses: bahmutov/npm-install@v1

      # Check if the library builds
      - name: Build Library
        run: yarn build

      # Check if the Storybook builds
      - name: Build Storybook
        run: yarn build-storybook

      - name: Publish Storybook
        run: yarn publish-storybook --ci
